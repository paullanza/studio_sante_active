<div class="container mt-4">
  <h1>
    Fliip User
    <small class="text-muted">#<%= @fliip_user.remote_id %></small>
    <%= button_to "⟳ Refresh from API",
                  refresh_fliip_user_path(@fliip_user.remote_id),
                  method: :post,
                  form_class: "d-inline",
                  class: "btn btn-sm btn-outline-secondary ms-2",
                  data: { turbo: false } %>
  </h1>

  <h2 class="mt-4">Attributes</h2>
  <table class="table table-bordered table-sm">
    <tbody>
      <tr>
        <td colspan="2" class="text-center">
          <%= image_tag @fliip_user.user_image if @fliip_user.user_image.present? %>
        </td>
      </tr>
      <% @fliip_user.attributes.each do |attr, value| %>
        <tr>
          <th class="text-capitalize"><%= attr.titleize %></th>
          <td><%= value.presence || "–" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <h2 class="mt-4">Contracts</h2>
  <% if @fliip_user.fliip_contracts.any? %>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <thead class="thead-light">
          <tr>
            <th>Contract #</th>
            <th>Status</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Stop Date</th>
            <th>Resume Date</th>
            <th>Cancel Date</th>
            <th>Membership Name</th>
            <th>Plan Description</th>
            <th>Duration</th>
          </tr>
        </thead>
        <tbody>
          <% @fliip_user.fliip_contracts.each do |contract| %>
            <tr>
              <td><%= contract.remote_contract_id %></td>
              <td><%= contract.status.presence || "–" %></td>
              <td><%= contract.start_date || "–" %></td>
              <td><%= contract.end_date   || "–" %></td>
              <td><%= contract.stop_date  || "–" %></td>
              <td><%= contract.resume_date || "–" %></td>
              <td><%= contract.cancel_date || "–" %></td>
              <td><%= contract.membership_name.presence || "–" %></td>
              <td><%= contract.plan_description.presence || "–" %></td>
              <td><%= contract.duration.presence || "–" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="text-muted">No contracts found for this user.</p>
  <% end %>

  <h2 class="mt-4">Services</h2>
  <% if @fliip_user.fliip_services.any? %>
    <div class="table-responsive">
      <%= render "shared/services_table", services: @fliip_user.fliip_services %>
    </div>
  <% else %>
    <p class="text-muted">No services found for this user.</p>
  <% end %>

  <%= link_to "← Back to list", fliip_users_path, class: "btn btn-secondary mt-3" %>
</div>
