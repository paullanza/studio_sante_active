<div class="container mt-4">
  <h1>
    Fliip User
    <small class="text-muted">#<%= @fliip_user.remote_id %></small>
  </h1>

  <h2 class="mt-4">Attributes</h2>
  <table class="table table-bordered table-sm">
    <tbody>
      <tr>
        <td colspan="2" class="text-center">
          <%= image_tag @fliip_user.user_image if @fliip_user.user_image.present? %>
        </td>
      </tr>
      <% @fliip_user.attributes.each do |attr, value| %>
        <tr>
          <th class="text-capitalize"><%= attr.titleize %></th>
          <td><%= value.presence || "–" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <h2 class="mt-4">Contracts</h2>
  <% if @fliip_user.fliip_contracts.any? %>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <thead class="thead-light">
          <tr>
            <th>Contract #</th>
            <th>Status</th>
            <th>Main?</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Stop Date</th>
            <th>Resume Date</th>
            <th>Cancel Date</th>
            <th>Membership Name</th>
            <th>Plan Base Type</th>
            <th>Plan Type</th>
            <th>Plan Description</th>
            <th>Plan Classes</th>
            <th>Payment Terms</th>
            <th>Duration</th>
            <th>Billed at Purchase</th>
            <th>Rebate</th>
            <th>Discount Name</th>
            <th>Ledger Account</th>
            <th>Pack Class #</th>
            <th>Pack Class Used</th>
          </tr>
        </thead>
        <tbody>
          <% @fliip_user.fliip_contracts.each do |contract| %>
            <tr>
              <td><%= contract.remote_contract_id %></td>
              <td><%= contract.status.presence || "–" %></td>
              <td><%= contract.main_user_contract ? "Yes" : "No" %></td>
              <td><%= contract.start_date || "–" %></td>
              <td><%= contract.end_date   || "–" %></td>
              <td><%= contract.stop_date  || "–" %></td>
              <td><%= contract.resume_date || "–" %></td>
              <td><%= contract.cancel_date || "–" %></td>
              <td><%= contract.membership_name.presence || "–" %></td>
              <td><%= contract.plan_base_type.presence || "–" %></td>
              <td><%= contract.plan_type.presence || "–" %></td>
              <td><%= contract.plan_description.presence || "–" %></td>
              <td><%= contract.plan_classes.presence || "–" %></td>
              <td><%= contract.payment_terms.presence || "–" %></td>
              <td><%= contract.duration.presence || "–" %></td>
              <td><%= contract.billed_at_purchase || 0 %></td>
              <td><%= contract.rebate.presence || "–" %></td>
              <td><%= contract.discount_name.presence || "–" %></td>
              <td><%= contract.ledger_account.presence || "–" %></td>
              <td><%= contract.pack_class_num || 0 %></td>
              <td><%= contract.pack_class_used || 0 %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="text-muted">No contracts found for this user.</p>
  <% end %>

  <h2 class="mt-4">Services</h2>
  <% if @fliip_user.fliip_services.any? %>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <thead class="thead-light">
          <tr>
            <th>Purchase #</th>
            <th>Status</th>
            <th>Start Date</th>
            <th>Expire Date</th>
            <th>Purchase Date</th>
            <th>Stop Date</th>
            <th>Cancel Date</th>
            <th>Rebate</th>
            <th>Stop Payments?</th>
            <th>Discount Name</th>
            <th>Service ID</th>
            <th>Service Name</th>
            <th>Service Type</th>
            <th>Category</th>
            <th>Coach</th>
            <th>Payment Terms</th>
            <th>Duration</th>
            <th>Online Enabled</th>
            <th>Description</th>
            <th>Billed at Purchase</th>
            <th>Ledger Account</th>
          </tr>
        </thead>
        <tbody>
          <% @fliip_user.fliip_services.each do |svc| %>
            <tr>
              <td><%= svc.remote_purchase_id %></td>
              <td><%= svc.purchase_status.presence || "–" %></td>
              <td><%= svc.start_date || "–" %></td>
              <td><%= svc.expire_date || "–" %></td>
              <td><%= svc.purchase_date || "–" %></td>
              <td><%= svc.stop_date || "–" %></td>
              <td><%= svc.cancel_date || "–" %></td>
              <td><%= svc.rebate.presence || "–" %></td>
              <td><%= svc.stop_payments ? "Yes" : "No" %></td>
              <td><%= svc.discount_name.presence || "–" %></td>
              <td><%= svc.service_id %></td>
              <td><%= svc.service_name.presence || "–" %></td>
              <td><%= svc.service_type.presence || "–" %></td>
              <td><%= svc.service_category_name.presence || "–" %></td>
              <td><%= svc.coach.presence || "–" %></td>
              <td><%= svc.payment_terms.presence || "–" %></td>
              <td><%= svc.duration.presence || "–" %></td>
              <td><%= svc.online_enabled.presence || "–" %></td>
              <td><%= svc.service_description.presence || "–" %></td>
              <td><%= svc.billed_at_purchase || 0 %></td>
              <td><%= svc.ledger_account.presence || "–" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="text-muted">No services found for this user.</p>
  <% end %>

  <%= link_to "← Back to list", root_path, class: "btn btn-secondary mt-3" %>
</div>
