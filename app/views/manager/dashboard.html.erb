<div class="container mt-4">
  <h1 class="mb-4">Manager Dashboard</h1>

  <div class="mb-4 d-flex flex-wrap gap-3">
    <!-- Managers: can browse/manage services via manager routes -->
    <%= link_to "Manage Service Session Limits", manager_services_path, class: "btn btn-outline-dark" %>

    <!-- (Optional) Add safe links for managers only if you have equivalents:
         e.g., <%= link_to "Browse Clients", fliip_users_path, class: "btn btn-outline-secondary" %> -->
  </div>

  <section class="mb-5">
    <h2>Users</h2>
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Name</th>
          <th>Role</th>
          <th>Status</th>
          <th class="text-center">Unconf.</th>
          <th class="text-center">Services</th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td><%= link_to user.full_name, user_path(user), class: "text-decoration-none" %></td>

            <td>
              <% role_badge_class =
                   case
                   when user.super_admin? then "bg-dark"
                   when user.admin?       then "bg-primary"
                   when user.manager?     then "bg-info text-dark"
                   else                        "bg-secondary"
                   end %>
              <span class="badge <%= role_badge_class %>"><%= user.role.titleize %></span>
            </td>

            <td>
              <span class="badge <%= user.active? ? 'bg-success' : 'bg-secondary' %>">
                <%= user.active? ? 'Active' : 'Inactive' %>
              </span>
            </td>

            <!-- New: per-user activity summaries -->
            <td class="text-center">
              <span class="badge bg-warning text-dark">
                <%= @unconfirmed_counts[user.id].to_i %>
              </span>
            </td>
            <td class="text-center">
              <span class="badge bg-secondary">
                <%= @services_touched_counts[user.id].to_i %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>

  <!-- Services ending soon -->
  <section class="mb-5">
    <h2>Services Ending in Next 30 Days</h2>
    <div class="table-responsive">
      <%= render "shared/services_table", services: @services_ending_soon %>
    </div>
  </section>

  <!-- Services ended recently -->
  <section class="mb-5">
    <h2>Services Ended in Last 30 Days</h2>
    <div class="table-responsive">
      <%= render "shared/services_table", services: @services_ended_recent %>
    </div>
  </section>
</div>
